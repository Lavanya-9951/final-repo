<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pocket Mood Garden</title>
  <style>
    :root{--bg:#f4fbf9;--card:#ffffff;--muted:#6b7280;--accent:#2b9d7a}
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial; margin:0; background:linear-gradient(180deg,var(--bg),#eaf7f1); color:#0f172a}
    .wrap{max-width:1000px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between}
    h1{margin:0;font-size:1.4rem}
    .card{background:var(--card);border-radius:14px;padding:16px;box-shadow:0 6px 18px rgba(17,24,39,0.06);}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:16px;margin-top:16px}
    label{display:block;font-size:0.85rem;margin-bottom:8px;color:var(--muted)}
    .row{display:flex;gap:8px;align-items:center}
    input[type=text],textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef0;background:#fafefe}
    textarea{min-height:72px}
    .btn{background:var(--accent);color:white;padding:10px 12px;border-radius:10px;border:none;cursor:pointer}
    .btn.secondary{background:#efefef;color:#0b1220}
    .entries{margin-top:12px;max-height:280px;overflow:auto}
    .entry{display:flex;justify-content:space-between;padding:8px;border-radius:8px;border:1px solid #eef6f3;margin-bottom:8px}
    .muted{color:var(--muted)}
    /* Plant area */
    .garden{display:flex;flex-direction:column;align-items:center;gap:12px;padding:18px}
    .pot{width:180px;height:120px;display:flex;align-items:flex-end;justify-content:center}
    .soil{width:140px;height:34px;background:#5b3b2e;border-radius:8px;box-shadow:inset 0 -6px 12px rgba(0,0,0,0.12)}
    .stem{width:6px;background:#2b9d7a;border-radius:6px;margin-bottom:4px;transition:height 600ms ease}
    .leaf{width:60px;height:34px;background:#2b9d7a;border-radius:60px 60px 20px 20px;position:relative;transform-origin:left center;transition:transform 600ms ease}
    .leaf.right{transform-origin:right center}
    .flower{width:40px;height:40px;border-radius:50%;background:#ffd166;display:flex;align-items:center;justify-content:center;font-weight:700}
    .plant-stage{display:flex;gap:6px;align-items:flex-end}
    .controls{display:flex;gap:8px}
    .small{font-size:0.85rem;padding:8px}
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:0.85rem}
    /* responsive */
    @media(max-width:900px){.grid{grid-template-columns:1fr;}.garden{order:-1}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Pocket Mood Garden ðŸŒ±</h1>
      <div class="muted">Track moods â€” watch a plant grow</div>
    </header>

    <div class="grid">
      <section class="card">
        <form id="moodForm">
          <label for="mood">Today's mood</label>
          <div class="row" style="align-items:center">
            <input id="moodText" type="text" placeholder="one-word mood (e.g., happy, tired)" required />
            <select id="intensity" style="width:110px">
              <option value="1">1 â€” low</option>
              <option value="2">2</option>
              <option value="3" selected>3 â€” medium</option>
              <option value="4">4</option>
              <option value="5">5 â€” high</option>
            </select>
          </div>

          <label for="note">Note (optional)</label>
          <textarea id="note" placeholder="Write one or two lines about today..."></textarea>

          <div style="display:flex;gap:8px;margin-top:10px">
            <button class="btn" type="submit">Add entry</button>
            <button id="exportBtn" type="button" class="btn secondary small">Export JSON</button>
            <button id="resetBtn" type="button" class="btn secondary small">Reset</button>
          </div>
        </form>

        <div class="muted" style="margin-top:12px">Entries</div>
        <div class="entries card" id="entries"></div>
      </section>

      <aside class="card garden">
        <div style="text-align:center;">
          <strong id="scoreText">Growth: 0</strong>
          <div class="muted" style="font-size:0.9rem">Consistent entries make your garden flourish.</div>
        </div>

        <div class="pot" aria-hidden="true">
          <div style="text-align:center">
            <div class="plant-stage" id="plant"> 
              <!-- generated by JS -->
            </div>
            <div class="soil" style="margin:8px auto 0"></div>
          </div>
        </div>

        <div class="controls">
          <button id="waterBtn" class="btn small">Water</button>
          <button id="sunBtn" class="btn small">Sun</button>
          <button id="cheerBtn" class="btn small">Cheer ðŸ˜Š</button>
        </div>

        <div style="width:100%;margin-top:8px;text-align:left">
          <label class="muted">History calendar</label>
          <div id="history" style="display:flex;flex-wrap:wrap;gap:6px;margin-top:6px"></div>
        </div>
      </aside>
    </div>

    <footer class="muted">Local only â€” your mood data stays in this browser (localStorage).</footer>
  </div>

  <script>
    // Simple client-side app: stores entries in localStorage
    const FORM = document.getElementById('moodForm');
    const ENTRIES = document.getElementById('entries');
    const PLANT = document.getElementById('plant');
    const HISTORY = document.getElementById('history');
    const SCORETEXT = document.getElementById('scoreText');

    const STORAGE_KEY = 'pocket-mood-garden-entries-v1';

    let entries = loadEntries();

    function loadEntries(){
      try{ const raw = localStorage.getItem(STORAGE_KEY); return raw? JSON.parse(raw): [] }catch(e){return []}
    }
    function saveEntries(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(entries)); }

    function addEntry(mood, intensity, note){
      const now = new Date();
      entries.unshift({id:now.getTime(),date:now.toISOString(),mood, intensity: Number(intensity), note});
      // keep 365 entries max
      entries = entries.slice(0,365);
      saveEntries();
      render();
    }

    function removeEntry(id){ entries = entries.filter(e=>e.id!==id); saveEntries(); render(); }

    function renderEntries(){
      ENTRIES.innerHTML = '';
      if(entries.length===0){ ENTRIES.innerHTML = '<div class="muted">No entries yet â€” add your first mood!</div>'; return }
      for(const e of entries){
        const el = document.createElement('div');
        el.className = 'entry';
        el.innerHTML = `<div>
          <strong>${escapeHtml(e.mood)}</strong> <span class="muted">(x${e.intensity})</span>
          <div class="muted" style="font-size:0.85rem">${new Date(e.date).toLocaleString()}</div>
          <div style="margin-top:6px">${escapeHtml(e.note||'')}</div>
        </div>
        <div style="text-align:right">
          <button class="btn secondary small" data-id="${e.id}" aria-label="delete">Delete</button>
        </div>`;
        ENTRIES.appendChild(el);
      }
      // attach delete handlers
      ENTRIES.querySelectorAll('button[data-id]').forEach(b=> b.addEventListener('click', () => removeEntry(Number(b.dataset.id))));
    }

    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c])); }

    function computeGrowthScore(){
      // score based on recency and intensity
      if(entries.length===0) return 0;
      const now = Date.now();
      let score = 0;
      for(const e of entries){
        const daysAgo = Math.min(30, Math.floor((now - new Date(e.date))/ (1000*60*60*24)));
        const decay = Math.max(0.1, 1 - (daysAgo/30));
        score += e.intensity * decay;
      }
      return Math.round(score);
    }

    function renderPlant(){
      const score = computeGrowthScore();
      SCORETEXT.textContent = `Growth: ${score}`;
      // define growth stages 0..5
      const level = Math.max(0, Math.min(5, Math.floor(score/6)));
      PLANT.innerHTML = '';
      for(let i=0;i<level;i++){
        const stem = document.createElement('div');
        stem.style.height = (30 + i*18) + 'px';
        stem.className = 'stem';
        const leafL = document.createElement('div'); leafL.className='leaf'; leafL.style.transform = `rotate(${ -15 - i*4 }deg)`;
        const leafR = document.createElement('div'); leafR.className='leaf right'; leafR.style.transform = `rotate(${ 15 + i*4 }deg)`;
        const container = document.createElement('div'); container.style.display='flex'; container.style.flexDirection='column'; container.style.alignItems='center';
        container.appendChild(stem);
        // add leaves for levels >1
        if(i>0){
          const leaves = document.createElement('div'); leaves.style.display='flex'; leaves.style.gap='6px'; leaves.style.marginTop='-16px'; leaves.appendChild(leafL); leaves.appendChild(leafR);
          container.appendChild(leaves);
        }
        PLANT.appendChild(container);
      }
      // flower appears at highest stage
      if(level>=5){ const flower = document.createElement('div'); flower.className='flower'; flower.textContent='â˜…'; PLANT.appendChild(flower); }

      if(level===0){ PLANT.innerHTML = '<div class="muted" style="font-size:0.9rem">Plant is a seed. Add entries to grow it.</div>' }
    }

    function renderHistory(){
      HISTORY.innerHTML = '';
      const byDate = {};
      for(const e of entries){ const d = new Date(e.date).toISOString().slice(0,10); byDate[d] = (byDate[d]||0) + 1 }
      const keys = Object.keys(byDate).slice(0,30);
      if(keys.length===0){ HISTORY.innerHTML = '<div class="muted">No history</div>'; return }
      for(const k of keys){
        const pill = document.createElement('div');
        pill.style.padding='6px 8px'; pill.style.borderRadius='8px'; pill.style.border='1px solid #eef6f3'; pill.style.fontSize='0.8rem';
        pill.textContent = `${k.split('-').slice(1).join('/')} (${byDate[k]})`;
        HISTORY.appendChild(pill);
      }
    }

    function render(){ renderEntries(); renderPlant(); renderHistory(); }

    // form handling
    FORM.addEventListener('submit', e=>{
      e.preventDefault();
      const mood = document.getElementById('moodText').value.trim();
      const intensity = document.getElementById('intensity').value;
      const note = document.getElementById('note').value.trim();
      if(!mood) return alert('Please enter a mood word.');
      addEntry(mood, intensity, note);
      FORM.reset();
    });

    // quick actions
    document.getElementById('waterBtn').addEventListener('click', ()=>{
      // water increases the intensity of the last entry (simulate care)
      if(entries.length===0) return alert('No entries to water yet â€” add a mood first.');
      entries[0].intensity = Math.min(5, entries[0].intensity + 1);
      saveEntries(); render();
    });
    document.getElementById('sunBtn').addEventListener('click', ()=>{
      // sun adds a small booster entry with 'sunny' mood
      addEntry('sunny', 2, 'quick sun boost');
    });
    document.getElementById('cheerBtn').addEventListener('click', ()=>{
      alert('You cheered your plant â€” take a deep breath ðŸŒ¿');
    });

    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(entries, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'mood-garden.json'; a.click(); URL.revokeObjectURL(url);
    });

    document.getElementById('resetBtn').addEventListener('click', ()=>{
      if(confirm('Reset garden and remove all entries? This cannot be undone.')){
        entries = []; saveEntries(); render();
      }
    });

    // initial render
    render();
  </script>
</body>
</html>
